# Ralph Progress Log - Duit Financial Tracker
# Branch: ralph/duit-financial-tracker
# Started: 2026-01-11

## Codebase Patterns
- Tailwind v4 uses `@import "tailwindcss"` and `@theme { }` for custom colors
- Svelte 5 runes mode uses `$props()` instead of `export let`
- Custom colors defined both in `@theme` (for Tailwind classes) and `:root` (for CSS variables)
- Database: Dexie.js v4 in `src/lib/db/index.ts` with EntityTable types and CRUD functions exported
- Icons: Use lucide-svelte for icons (Home, Calendar, Settings, etc.)
- Routing: Use `import { page } from '$app/state'` and `page.url.pathname` for active route detection
- Testing: Vitest configured with `defineConfig` from 'vitest/config' (not 'vite') to avoid typecheck errors
- Services: Place service modules in `src/lib/services/` (e.g., parser.ts, categorizer.ts)
- Categorizer: Import `categorize` (async) or `categorizeFromDefaults` (sync) from `$lib/services/categorizer`
- Gemini API: Use `categorizeWithGemini()` for AI categorization, `categorizeWithFallback()` for full chain with local + AI
- Environment vars: Use `import.meta.env.VITE_*` for client-side env vars in SvelteKit
- Tests: Use `globalThis.fetch` (not `global.fetch`) for mocking fetch in tests to avoid TS errors
- Reactive queries: Use `liveQuery()` from 'dexie' with `$effect()` to auto-update UI when IndexedDB data changes
- Date formatting: Use `date-fns` with `import { id as idLocale } from 'date-fns/locale'` for Indonesian locale
- Derived values: Use `$derived()` for computed values that depend on reactive props to avoid Svelte warnings
- Category names: Use `getCategoryDisplayName(category)` from `$lib/stores/categoryNames` for customized display names

---

## 2026-01-11 - US-001
Iteration: 1
- Verified SvelteKit project initialization with Svelte 5 (runes mode)
- Verified Tailwind CSS v4 with custom color palette in @theme block
- Verified Plus Jakarta Sans font imported via Google Fonts
- Verified CSS variables in app.css for colors
- Verified npm run dev works (Vite v6.4.1)
- Verified typecheck passes (0 errors, 0 warnings)
- All acceptance criteria already met from previous commit
- **Learnings for future iterations:**
  - Tailwind v4 uses `@theme { }` block syntax for custom colors instead of tailwind.config.js
  - Svelte 5 runes mode: use `$props()` for receiving props, `$state()` for reactive state
  - Plus Jakarta Sans loaded via Google Fonts CDN in app.html
---

## 2026-01-11 - US-002
Iteration: 2
- Installed Dexie.js v4.2.1 for IndexedDB wrapper
- Created src/lib/db/index.ts with database configuration
- Defined TypeScript interfaces: Transaction, Budget, CategoryMapping
- Defined Category type with all 7 categories
- Defined TransactionType as 'expense' | 'income'
- Created database schema with indexed columns for efficient querying
- Implemented full CRUD operations for all three tables
- Typecheck passes (0 errors, 0 warnings)
- Files changed: package.json, package-lock.json, src/lib/db/index.ts
- **Learnings for future iterations:**
  - Dexie v4 uses EntityTable type for typed table access
  - Use `++id` in schema for auto-increment primary keys
  - The `add()` method can return `number | undefined` so type assertion may be needed
  - Use `.orderBy().reverse()` for descending sort, `.limit()` for pagination
---

## 2026-01-11 - US-003
Iteration: 3
- Installed lucide-svelte for icon components
- Created BottomNav.svelte with Home, Calendar, Settings icons
- Bottom nav fixed at screen bottom with 44x44px touch targets
- Active tab highlighted with primary color (#2563EB) using reactive pathname check
- Updated +layout.svelte to wrap content with bottom padding (pb-16) for nav space
- Created /monthly and /settings route pages as placeholders
- Navigation works via SvelteKit routing (/, /monthly, /settings)
- Build passes, typecheck passes (0 errors, 0 warnings)
- Files changed: package.json, package-lock.json, src/lib/components/BottomNav.svelte, src/routes/+layout.svelte, src/routes/+page.svelte, src/routes/monthly/+page.svelte, src/routes/settings/+page.svelte
- **Learnings for future iterations:**
  - Use `import { page } from '$app/state'` for accessing current route in Svelte 5
  - Use `page.url.pathname` to check active route
  - lucide-svelte icons accept `size` and `strokeWidth` props for customization
  - For sub-routes, check with `pathname.startsWith()` for nested routes like /settings/*
---

## 2026-01-11 - US-004
Iteration: 4
- Created QuickInput.svelte component in src/lib/components/
- Fixed position at bottom-16 (above the bottom nav)
- Placeholder text 'bakso 15rb...' for Indonesian expense entry
- Submit via Enter key or tap submit button (Send icon from lucide-svelte)
- Input clears after successful submission with focus retained
- Min height 44px, full width with padding for touch-friendly input
- Integrated into Home page with event dispatcher for submit handling
- Typecheck and build pass (0 errors, 0 warnings)
- Files changed: src/lib/components/QuickInput.svelte (new), src/routes/+page.svelte
- **Learnings for future iterations:**
  - Use `createEventDispatcher` from 'svelte' for component events in Svelte 5
  - `$state()` for reactive local state, bind:value for two-way binding
  - Fixed positioning with `bottom-16` places element above the 64px (h-16) nav bar
  - Home page uses `pb-20` to account for both nav (h-16) and input bar space
---

## 2026-01-11 - US-005
Iteration: 5
- Created parser service in src/lib/services/parser.ts
- Implemented parseAmount() function for Indonesian currency formats:
  - rb/ribu/k suffixes for thousands (15rb -> 15000)
  - jt/juta suffixes for millions (1.5jt -> 1500000)
  - Thousand separators (15.000, 15,000 -> 15000)
  - Decimal support with comma or period (1,5rb -> 1500)
- Implemented parseInput() function to extract description and amount from mixed strings
  - "bakso 15rb" -> { description: "bakso", amount: 15000 }
  - Returns null for unparseable input or missing description
- Added vitest for unit testing (49 tests covering all formats)
- Configured vite.config.ts with vitest/config defineConfig
- Added test and test:run npm scripts to package.json
- Typecheck passes (0 errors, 0 warnings)
- All tests pass
- Files changed: src/lib/services/parser.ts (new), src/lib/services/parser.test.ts (new), package.json, package-lock.json, vite.config.ts
- **Learnings for future iterations:**
  - Import `defineConfig` from 'vitest/config' (not 'vite') to include test property in config
  - Use regex patterns for parsing Indonesian currency formats
  - Amount patterns: /(\d+)([.,](\d+))?\s*(rb|ribu|k)$/i for thousands
  - Test file naming: *.test.ts in same directory as source file
---

## 2026-01-11 - US-006
Iteration: 6
- Created categorizer service in src/lib/services/categorizer.ts
- Default keyword mappings (DEFAULT_KEYWORDS) for 6 expense categories + income:
  - food: bakso, mie, nasi, kopi, gofood, grabfood, makan, ayam, sate, etc.
  - transport: grab, gojek, bensin, parkir, tol, ojol, taxi, etc.
  - bills: listrik, pln, wifi, pulsa, sewa, kos, pdam, etc.
  - shopping: shopee, tokopedia, baju, indomaret, alfamart, etc.
  - entertainment: netflix, spotify, bioskop, game, cinema, etc.
  - income: gaji, salary, freelance, bonus, thr, dividen, etc.
- Implemented categorize() async function with priority:
  1. Exact match in categoryMappings table (user-learned)
  2. Exact match in DEFAULT_KEYWORDS
  3. Partial match (word contains keyword)
  4. Fuzzy match using Levenshtein distance (threshold 0.7)
- Implemented categorizeFromDefaults() sync function for quick lookups
- Levenshtein distance algorithm for string similarity calculation
- 40 unit tests covering all scenarios including typos
- Typecheck passes, all 89 tests pass (49 parser + 40 categorizer)
- Files changed: src/lib/services/categorizer.ts (new), src/lib/services/categorizer.test.ts (new)
- **Learnings for future iterations:**
  - Use Levenshtein distance for fuzzy string matching
  - stringSimilarity = 1 - (distance / maxLength) gives 0-1 score
  - Threshold of 0.7 works well for typos like 'bkso' -> 'bakso'
  - Mock Dexie database functions with vi.mock('$lib/db', ...)
  - Split description into words and check each against keywords
---

## 2026-01-11 - US-007
Iteration: 7
- Created Gemini API service in src/lib/services/gemini.ts
- API key read from VITE_GEMINI_API_KEY environment variable via import.meta.env
- Uses Gemini 1.5 Flash model for fast categorization
- Prompt instructs AI to return single category: food, transport, bills, shopping, entertainment, income, other
- Fallback to 'other' on any error:
  - Missing API key
  - API error responses (401, 500, etc.)
  - Network errors (offline)
  - Empty/invalid responses
- Successful AI categorizations saved to categoryMappings table via setCategoryMapping()
- Added categorizeWithFallback() to categorizer.ts for integrated local + AI categorization
- 18 unit tests for Gemini service, all 107 tests pass (49 parser + 40 categorizer + 18 gemini)
- Typecheck and build pass
- Files changed: src/lib/services/gemini.ts (new), src/lib/services/gemini.test.ts (new), src/lib/services/categorizer.ts
- **Learnings for future iterations:**
  - Use `import.meta.env.VITE_*` for client-side env vars in SvelteKit
  - Use `globalThis.fetch` instead of `global.fetch` in tests for TypeScript compatibility
  - Gemini API endpoint: `generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent`
  - Use low temperature (0.1) and low maxOutputTokens (20) for deterministic category responses
  - Always handle API errors gracefully - return fallback value, don't crash
---

## 2026-01-11 - US-008
Iteration: 8
- Created ConfirmationModal.svelte in src/lib/components/
- Modal slides up from bottom with backdrop overlay
- Shows parsed description (capitalized) and amount formatted as Indonesian Rupiah (Rp)
- Category pills for all 7 categories displayed horizontally with wrap
- Selected category highlighted with primary color (#2563EB)
- Toggle button for expense/income type with visual feedback (red for expense, green for income)
- Auto-sets type to income when income category selected
- Confirm button saves transaction to IndexedDB via addTransaction()
- Cancel button dismisses modal without saving
- Backdrop click and Escape key also dismiss modal
- Integrated with Home page: QuickInput submit -> parseInput -> categorizeWithFallback -> show modal
- Typecheck passes (0 errors, 1 warning for initial state capture which is intentional)
- Build passes, all 107 tests pass
- Files changed: src/lib/components/ConfirmationModal.svelte (new), src/routes/+page.svelte
- **Learnings for future iterations:**
  - Use `$bindable()` for two-way prop binding in Svelte 5
  - Use `$effect()` to react to prop changes and update local state
  - Use `<!-- svelte-ignore a11y_click_events_have_key_events -->` for backdrop click handlers
  - Format Indonesian Rupiah with `toLocaleString('id-ID')` for proper thousand separators
  - Modal components work well as bottom sheets on mobile (rounded-t-2xl, animate slide-up)
---

## 2026-01-11 - US-009
Iteration: 9
- Created SpendingSummary.svelte component in src/lib/components/
- Displays today's and this week's spending at top of Home page
- Uses Dexie `liveQuery` for reactive real-time updates when transactions change
- Week starts on Monday, ends Sunday (ISO week standard)
- Only counts expenses (filters by type === 'expense')
- Indonesian Rupiah formatting with `toLocaleString('id-ID')` for thousand dot separators
- Integrated into Home page between header and transaction list placeholder
- Typecheck passes (0 errors, 1 existing warning)
- Build passes, all 107 tests pass
- Files changed: src/lib/components/SpendingSummary.svelte (new), src/routes/+page.svelte
- **Learnings for future iterations:**
  - Use `liveQuery` from 'dexie' for reactive queries that auto-update when data changes
  - Use `$effect()` with `$liveQueryResult` syntax to subscribe to Dexie observable queries
  - For week calculation: `dayOfWeek === 0 ? 6 : dayOfWeek - 1` converts Sunday=0 to Monday-based index
  - Date range queries: use `.where('date').between(start, end, true, true)` for inclusive bounds
---

## 2026-01-11 - US-010
Iteration: 10
- Created CategoryPill.svelte sub-component with category-specific colors
  - Each category has distinct background/text color combination
  - Supports 'sm' and 'md' sizes
- Created TransactionCard.svelte component for displaying transactions
  - Lucide icons for each category: Utensils (food), Car (transport), Receipt (bills), ShoppingBag (shopping), Film (entertainment), Wallet (income), HelpCircle (other)
  - Relative time display using date-fns with Indonesian locale (id)
  - Amount formatting: income shows green with +Rp prefix, expense shows neutral text with -Rp prefix
  - Category icon displayed in colored circular background
- Installed date-fns for relative time formatting
- Typecheck passes (0 errors), build passes, all 107 tests pass
- Files changed: src/lib/components/CategoryPill.svelte (new), src/lib/components/TransactionCard.svelte (new), package.json, package-lock.json
- **Learnings for future iterations:**
  - Import date-fns locale separately: `import { id as idLocale } from 'date-fns/locale'`
  - Use `formatDistanceToNow(date, { addSuffix: true, locale: idLocale })` for localized relative time
  - Use `$derived()` instead of `const` for computed values that depend on props to avoid svelte warnings
  - Category icons mapping: `Record<Category, typeof Utensils>` for type-safe icon components
  - Use `truncate` class for overflow text in card layouts
---

## 2026-01-11 - US-011
Iteration: 11
- Implemented recent transactions list on Home page
  - Displays last 10 transactions using TransactionCard component
  - List sorted by newest first (createdAt descending)
  - Uses Dexie liveQuery for reactive real-time updates
- Added tap to edit functionality
  - ConfirmationModal updated with isEditMode and editingTransaction props
  - Modal shows "Edit Transaction" header in edit mode
  - updateTransaction() from db used to save changes
- Implemented swipe left to delete
  - Touch handlers track swipe distance
  - Delete confirmation dialog shown when swipe threshold (60px) exceeded
  - Transaction deleted via deleteTransaction() from db
- Added empty state message when no transactions exist
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/routes/+page.svelte, src/lib/components/ConfirmationModal.svelte
- **Learnings for future iterations:**
  - Use `$state('other')` instead of `$state(suggestedCategory)` to avoid "state_referenced_locally" warning
  - For swipe gestures: track touchstart X position, calculate diff in touchmove, trigger action in touchend
  - Use role="dialog" with tabindex="-1" for accessible modal dialogs
  - ConfirmationModal can support both create and edit modes with isEditMode boolean prop
---

## 2026-01-11 - US-012
Iteration: 12
- Created budget settings page at /settings/budgets
- Lists all 6 expense categories (food, transport, bills, shopping, entertainment, other)
- Each category displays with icon and color-coded circular background
- Input field for monthly limit in Rupiah with thousand separator formatting
- Save on blur or Enter key using setBudget() from db
- Toast notification shown on successful save (green success style)
- Updated Settings main page with Data section and Budgets link
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/routes/settings/+page.svelte, src/routes/settings/budgets/+page.svelte (new)
- **Learnings for future iterations:**
  - Use inputmode="numeric" for mobile-friendly number inputs
  - Format Rupiah input with toLocaleString('id-ID') for thousand separators
  - Parse input by removing non-digits before parseInt
  - Use liveQuery with $effect subscription for reactive IndexedDB data
  - Settings page pattern: section headers with card-style list items containing icons
---

## 2026-01-11 - US-013
Iteration: 13
- Created BudgetBar.svelte component in src/lib/components/
- Progress bar shows category name, spent amount / limit amount, and percentage
- Color-coded bars based on percentage:
  - Blue (#2563EB / bg-primary) for 0-79%
  - Orange (#F59E0B / bg-warning) for 80-99%
  - Red (#EF4444 / bg-danger) for 100%+
- Only renders for categories with budget limits set (limit > 0)
- Uses Dexie liveQuery for reactive updates when transactions change
- Displays category icon in circular colored background
- Progress bar has smooth width transition animation
- Sorted by highest percentage first (most concerning)
- Integrated on Home page below SpendingSummary component
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/components/BudgetBar.svelte (new), src/routes/+page.svelte
- **Learnings for future iterations:**
  - Use `$budgetsQuery` syntax to subscribe to liveQuery result in $effect
  - Combine multiple liveQuery subscriptions in one $effect for cross-data computation
  - Use Math.min(percentage, 100) to cap progress bar width at 100%
  - Date range: getStartOfMonth/getEndOfMonth for current month calculations
  - getEndOfMonth uses next month's day 0 which gives last day of current month
---

## 2026-01-11 - US-014
Iteration: 14
- Implemented budget warning on transaction entry
- Added checkBudgetWarning() function to src/lib/db/index.ts:
  - Calculates current month's spending for a category
  - Returns warning type 'exceeded' if 100%+, 'approaching' if 80-99%
  - Returns exceededBy amount for exceeded warnings
- Updated ConfirmationModal to emit budgetWarning event after saving expense transactions
- Added budget warning toast to Home page:
  - Danger (red) toast for exceeded budgets: "Food budget exceeded by Rp 50.000"
  - Warning (amber) toast for approaching budgets: "Food budget at 85%"
  - Auto-dismisses after 4 seconds
  - Manual dismiss via X button
  - Slide-down animation from top of screen
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/db/index.ts, src/lib/components/ConfirmationModal.svelte, src/routes/+page.svelte
- **Learnings for future iterations:**
  - Use createEventDispatcher with typed events for component communication
  - BudgetWarning interface exported from db for type safety across components
  - Use ReturnType<typeof setTimeout> for timeout type annotation
  - Toast positioned at top-4 with z-50 for proper layering above other content
  - CSS animations can be defined in component style block for slide effects
---

## 2026-01-11 - US-015
Iteration: 15
- Created MonthSelector.svelte component in src/lib/components/
- Header displays current month/year in Indonesian locale (e.g., "Januari 2026")
- Left ChevronLeft arrow navigates to previous month using date-fns subMonths()
- Right ChevronRight arrow navigates to next month using date-fns addMonths()
- Right arrow disabled (gray, cursor-not-allowed) when viewing current month (cannot go to future)
- Uses isSameMonth() from date-fns to compare selected month with current month
- Defaults to current month when Monthly tab opens via startOfMonth(new Date())
- Selected month stored in component state via selectedDate prop with onMonthChange callback
- Integrated into /monthly page with handleMonthChange function
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/components/MonthSelector.svelte (new), src/routes/monthly/+page.svelte
- **Learnings for future iterations:**
  - Use date-fns format() with { locale: idLocale } for Indonesian month names
  - date-fns functions: startOfMonth, subMonths, addMonths, isSameMonth for month navigation
  - ChevronLeft, ChevronRight icons from lucide-svelte for navigation arrows
  - Use $derived() for computed values based on props (e.g., canGoNext, displayText)
  - Parent component holds selectedDate state and passes via props with callback for changes
---

## 2026-01-11 - US-016
Iteration: 16
- Created MonthlySummary.svelte component in src/lib/components/
- Displays three columns: Total Income, Total Expenses, Net (income - expenses)
- Uses Dexie liveQuery with subscription for reactive updates when selectedDate changes
- Uses date-fns startOfMonth() and endOfMonth() for month range calculations
- Color coding: income always green (text-success), net green if >= 0, red (text-danger) if negative
- Rupiah formatting with thousand dot separators using toLocaleString('id-ID')
- Net shows + prefix for positive values
- Integrated into Monthly page below MonthSelector
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/components/MonthlySummary.svelte (new), src/routes/monthly/+page.svelte
- **Learnings for future iterations:**
  - Use liveQuery with .subscribe() inside $effect() for reactive queries that depend on props
  - Return cleanup function from $effect() to unsubscribe when dependencies change
  - Use $derived() for computed values like `net = totalIncome - totalExpenses`
  - endOfMonth() from date-fns gives last day of month, need to setHours(23,59,59,999) for inclusive range
---

## 2026-01-11 - US-017
Iteration: 17
- Created CategoryBreakdown.svelte component in src/lib/components/
- Displays spending by category with icons, names, amounts, and percentages
- Categories sorted by highest spending amount first
- Each row shows:
  - Category icon in colored circular background
  - Category name (Food, Transport, Bills, etc.)
  - Amount formatted in Rupiah (Rp 45.000)
  - Percentage of total expenses with number
  - Horizontal progress bar colored per category
- Uses Dexie liveQuery for reactive updates when transactions change
- Only renders when there are transactions for the selected month (empty = component hidden)
- Integrated into Monthly page below MonthlySummary
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/components/CategoryBreakdown.svelte (new), src/routes/monthly/+page.svelte
- **Learnings for future iterations:**
  - Use Exclude<Category, 'income'> type for expense-only category mappings
  - Map-based aggregation: iterate transactions, accumulate by category, then convert to sorted array
  - Use {@const IconComponent = CATEGORY_ICONS[item.category]} inside #each for dynamic component rendering
  - Progress bar width uses inline style with percentage: style="width: {item.percentage}%"
---

## 2026-01-11 - US-018
Iteration: 18
- Created AIInsightCard.svelte component in src/lib/components/
- Lightbulb icon from lucide-svelte with warning/amber colored circular background
- Added generateInsight() function to src/lib/services/gemini.ts:
  - SpendingData interface: totalIncome, totalExpenses, byCategory array, budgetStatus array
  - Sends spending summary to Gemini API with Indonesian prompt
  - Returns 1-2 sentence actionable tip in Bahasa Indonesia
  - Falls back to "Tips tidak tersedia saat ini" on errors or missing API key
- Loading skeleton: pulsing gray rectangles matching text line shapes (animate-pulse)
- In-memory Map cache stores insights per month using yyyy-MM key format
  - Cache persists across component re-renders (module-level Map)
  - Prevents re-fetching when switching back to already-viewed months
- Component fetches transactions and budgets using Dexie liveQuery
- Builds SpendingData from transactions (totals, category breakdown) and budget status
- Shows default message "Belum ada transaksi bulan ini" if no transactions exist
- Integrated at top of Monthly page (between MonthSelector and MonthlySummary)
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/lib/components/AIInsightCard.svelte (new), src/lib/services/gemini.ts, src/routes/monthly/+page.svelte
- **Learnings for future iterations:**
  - Use module-level Map for caching data that should persist across component lifecycles
  - format(date, 'yyyy-MM') from date-fns is good for month-level cache keys
  - Use gradient backgrounds (bg-gradient-to-r) for visually distinct cards
  - Temperature 0.7 for Gemini gives more varied/creative responses (vs 0.1 for deterministic)
  - maxOutputTokens: 150 is enough for 1-2 sentence tips
---

## 2026-01-11 - US-019
Iteration: 19
- Added scrollable transaction list to Monthly page below CategoryBreakdown component
- Transactions grouped by date with date headers in Indonesian locale (e.g., "Senin, 6 Januari")
- Uses Dexie liveQuery with $effect subscription for reactive updates when selectedDate changes
- groupedTransactions computed using $derived.by() for date grouping logic
- Uses TransactionCard component for each transaction (reused from Home page)
- Tap to edit functionality: opens ConfirmationModal in edit mode with transaction data pre-filled
- Swipe left to delete with confirmation dialog (same implementation as Home page)
- Delete confirmation dialog shows transaction description and cannot be undone warning
- Empty state message: "No transactions this month" with hint to add on Home tab
- Budget warning toast integrated from ConfirmationModal (same as Home page)
- Typecheck passes (0 errors, 0 warnings), build passes, all 107 tests pass
- Files changed: src/routes/monthly/+page.svelte
- **Learnings for future iterations:**
  - Use $derived.by(() => {...}) for complex computed values with multiple steps
  - format(date, 'EEEE, d MMMM', { locale: idLocale }) for localized date headers
  - Map-based grouping: iterate once, group by key, then convert to sorted array
  - endOfMonth() needs setHours(23, 59, 59, 999) for inclusive date range queries
  - Reuse TransactionCard, ConfirmationModal, swipe handlers pattern across pages for consistency
---

## 2026-01-11 - US-020
Iteration: 20
- Updated Settings page at /settings with grouped sections
- Three sections with headers: Data, Categories, Appearance
- Data section items: Budgets (existing), Export Data, Import Data
- Categories section items: Manage Categories, AI Keywords
- Appearance section item: Theme
- Each item displays: Lucide icon in colored circular background, label text, description, chevron-right
- Icons used: Wallet (budgets), Download (export), Upload (import), Tags (categories), Sparkles (keywords), Palette (theme)
- Created placeholder sub-pages with back navigation for: export, import, categories, keywords, theme
- All navigable items route to respective sub-pages
- Typecheck passes (0 errors, 0 warnings), build passes
- Files changed: src/routes/settings/+page.svelte, src/routes/settings/export/+page.svelte (new), src/routes/settings/import/+page.svelte (new), src/routes/settings/categories/+page.svelte (new), src/routes/settings/keywords/+page.svelte (new), src/routes/settings/theme/+page.svelte (new)
- **Learnings for future iterations:**
  - Settings page pattern: section headers (uppercase, gray, small text) with card-style grouped items
  - Use divide-y divide-border for item separators within card groups
  - Consistent icon sizes: 20px in 40x40px rounded-full colored background
  - Each section gets distinct icon colors: blue (data), green (export), amber (import), purple (categories), pink (keywords), indigo (theme)
  - Placeholder pages include ChevronLeft back button with -ml-2 offset for proper alignment
---

## 2026-01-11 - US-021
Iteration: 21
- Implemented category management page at /settings/categories
- Created categoryNames store in src/lib/stores/categoryNames.ts using localStorage
- Helper functions: getCategoryDisplayName(), setCategoryDisplayName(), getAllCategoryDisplayNames()
- Category management page lists all 7 categories with icons and current display names
- Each category row has Pencil edit button that opens inline text input
- Save on Enter key or blur, cancel on Escape key
- Toast notification shown on successful rename
- Shows "Default: [original name]" subtitle when category has been customized
- Cannot delete default categories, only rename
- Updated components to use getCategoryDisplayName():
  - CategoryPill.svelte - uses $derived(getCategoryDisplayName(category))
  - TransactionCard.svelte - already uses CategoryPill which now shows custom names
  - BudgetBar.svelte - displays custom category names in budget overview
  - CategoryBreakdown.svelte - displays custom category names in spending breakdown
  - ConfirmationModal.svelte - displays custom category names on category pills
  - +page.svelte (Home) - budget warning toasts show custom category names
  - +page.svelte (Monthly) - budget warning toasts show custom category names
  - /settings/budgets - displays custom category names in budget list
- Removed duplicate CATEGORY_LABELS constants from multiple files
- Typecheck passes (0 errors, 1 a11y warning for autofocus), build passes, all 107 tests pass
- Files changed: src/lib/stores/categoryNames.ts (new), src/lib/components/CategoryPill.svelte, src/lib/components/BudgetBar.svelte, src/lib/components/CategoryBreakdown.svelte, src/lib/components/ConfirmationModal.svelte, src/routes/+page.svelte, src/routes/monthly/+page.svelte, src/routes/settings/budgets/+page.svelte, src/routes/settings/categories/+page.svelte
- **Learnings for future iterations:**
  - Create centralized stores for app-wide settings like category names
  - Use localStorage for simple user preferences that need to persist
  - getCategoryDisplayName(category) returns custom name if set, otherwise default
  - Use $derived() to make component values reactive to store changes
  - Svelte a11y_autofocus warning is acceptable for edit mode inputs
  - Remove duplicate CATEGORY_LABELS when centralizing to a store
---


## 2026-01-11 - US-022
Iteration: 22
- Implemented data export functionality at /settings/export
- Added exportAllData() function in src/lib/db/index.ts:
  - Exports all three IndexedDB tables: transactions, budgets, categoryMappings
  - Returns BackupData interface with version field (BACKUP_VERSION = 1) for future compatibility
- Export page features:
  - Download button triggers export as duit-backup-YYYY-MM-DD.json
  - Uses date-fns format() for consistent date formatting in filename
  - Creates Blob with JSON content and triggers download via dynamically created anchor element
  - Proper cleanup of URL.createObjectURL after download
- Visual feedback:
  - Loading state with animated spinner and bounce icon
  - Success state with checkmark icon and export stats display
  - Stats show count of transactions, budgets, and keywords exported
  - Success state auto-hides after 5 seconds
- Info card with recommendation to export regularly and store in cloud storage
- Typecheck passes (0 errors, 1 existing a11y warning), build passes, all 107 tests pass
- Files changed: src/lib/db/index.ts, src/routes/settings/export/+page.svelte
- **Learnings for future iterations:**
  - Use Blob + URL.createObjectURL for client-side file downloads
  - Create anchor element, set href/download, click, then cleanup
  - BackupData interface with version field enables future schema migrations
  - format(date, 'yyyy-MM-dd') from date-fns for consistent filename date formatting
---

## 2026-01-11 - US-023
Iteration: 23
- Implemented data import functionality at /settings/import
- Added validateBackupData() function in src/lib/db/index.ts:
  - Validates JSON structure matches expected schema
  - Checks version field, data field presence
  - Validates each transaction (amount, description, category, type)
  - Validates each budget (category, limit)
  - Validates each categoryMapping (keyword, category, count)
  - Returns ImportValidationResult with valid boolean, error message, data, and stats
- Added importAllData() function in src/lib/db/index.ts:
  - Clears all existing data (transactions, budgets, categoryMappings)
  - Converts date strings back to Date objects for transactions
  - Uses bulkAdd/bulkPut for efficient batch insertion
- Import page features:
  - File picker accepting .json files only
  - Validation display: shows file name, validation status, and data stats
  - Green checkmark for valid files, red alert for invalid files
  - Confirmation dialog with warning about permanent data replacement
  - Loading spinner during import operation
  - Success state with imported data stats
  - Error state with error message display
- Warning card about data replacement prominently displayed
- Typecheck passes (0 errors, 1 existing a11y warning), build passes, all 107 tests pass
- Files changed: src/lib/db/index.ts, src/routes/settings/import/+page.svelte
- **Learnings for future iterations:**
  - Use file.text() + JSON.parse() for reading JSON files from file input
  - Validate backup data schema before importing to prevent data corruption
  - Convert date strings back to Date objects when importing JSON
  - Use bulkAdd/bulkPut for efficient batch database operations
  - Show confirmation dialog for destructive operations (data replacement)
---

## 2026-01-11 - US-024
Iteration: 24
- Implemented AI Keywords page at /settings/keywords
- Lists all categoryMappings entries from IndexedDB using Dexie liveQuery
- Each row displays: keyword text, usage count ("Used X times"), and CategoryPill component
- List sorted by count descending (most frequently used first)
- Tap category pill to edit: shows dropdown with all 7 categories
- Category change handled by updateCategoryMapping() from db
- Swipe left to delete with confirmation dialog
- Delete handled by deleteCategoryMapping() from db
- Toast notifications for successful category updates and deletions
- Info card at top explains the learned keywords feature
- Empty state shown when no keywords learned yet
- Typecheck passes (0 errors, 3 warnings - all handled with svelte-ignore), build passes, all 107 tests pass
- Files changed: src/routes/settings/keywords/+page.svelte
- **Learnings for future iterations:**
  - Use db.categoryMappings.orderBy('count').reverse() for sorted queries
  - updateCategoryMapping(keyword, newCategory) updates existing mapping
  - deleteCategoryMapping(keyword) removes a mapping
  - CategoryPill accepts category prop and displays with correct colors
  - Use Record<string, number> for swipe state tracking across multiple list items
---
